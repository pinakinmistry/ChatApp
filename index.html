<html>
<head>
	<title>Chat App on NodeJS</title>
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<style>
		body, input {
			font-family: "Century Gothic", CenturyGothic, Geneva, AppleGothic, sans-serif;
			font-size: 16px;
			margin: 0;
		}

		.wrapper {
			position: relative;
			width: 100%;
			max-width: 768px;
			height: 95%;
			margin: auto;
			padding: 5px;
			background: #000;
			color: ivory;
		}

		.title {
			font-size: 30px;
			margin-bottom: 5px;
		}

		#chats {
			height: 90%;
			overflow-y: scroll;
		}

		.chat {
			width: 100%;
			position: relative;
			float: left;
		}

		#messageTxt {
			width: 75%;
		}

		.message {
			width: 70%;
			padding: 3px 5px 3px 10px;
			border-bottom: 1px solid black;
			word-wrap:break-word;
		}

		.myMessage {
			float: left;
			background: #45b29d;
			clear: right;
		}

		.arrow-left {
			float: left;
			width: 0; 
			height: 0; 
			border-top: 5px solid transparent;
			border-bottom: 5px solid transparent; 
			border-right:5px solid #45b29d; 
		}

		.othersMessage {
			float: right;
			background: #EFC94C;
		}

		.arrow-right {
			float: right;
			width: 0; 
			height: 0; 
			border-top: 5px solid transparent;
			border-bottom: 5px solid transparent;
			border-left: 5px solid #EFC94C;
		}

		.floatRight {
			float: right;
		}
	</style>
</head>
<body>
	<div class="wrapper">
		<div class="title">Chat App on NodeJS</div>
		<div id="chats"></div>
		<form id="sendMessage">
			<input type="text" id="messageTxt"></input>
			<input type="submit"></input>
		</form>
	</div>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>

		jQuery(function($) {
			var socket = io.connect(),
				username = 'User' + Math.random().toFixed(2),
				$messageForm = $('#sendMessage'),
				$messageBox = $('#messageTxt'),
				$chats = $('#chats');

			$messageForm.submit(function(event) {
				event.preventDefault();
				if(!$messageBox.val()) { return; }
				socket.emit('send message', 
					{username: username, msg: $messageBox.val()});
				$messageBox.val('');
			});

			socket.on('new message', function(data) {
				if(data.username === username) {
					$chats.append('<div class="chat"><div class="arrow-left"></div><div class="message myMessage"><b>' + data.username + ': </b>' + data.msg + '</div></div>');
				} else {
					$chats.append('<div class="chat"><div class="arrow-right"></div><div class="message othersMessage"><b>' + data.username + ': </b>' + data.msg + '</div></div>');
				}
				$chats.animate({ scrollTop: $chats.prop("scrollHeight") - $chats.height() }, 300);
			});

		});

	</script>

</body>
</html>